var manager=angular.module("indyManager",["ngRoute","dndLists"]).run(["$location","$rootScope",function(t,e){e.config=config,e.$on("$routeChangeSuccess",function(t,r,o){r.hasOwnProperty("$$route")&&(e.title=r.$$route.title)})}]).controller("dashboard",["$scope","categoriesService",function(t,e){e.getList().then(function(e){t.listCategory=e},function(t){toastr.error("การแสดงผลผิดพลาด")})}]).controller("manual",["$scope",function(t){t.toggleStatus=[];var e=function(e,r){for(var o=0;o<e;o++)o!==r&&(t.toggleStatus[o]=!1)};e(5,-1),t.toggle=function(r){e(5,r),t.toggleStatus[r]=!t.toggleStatus[r]}}]).controller("categories",["$scope","categoriesService",function(t,e){t.listCategory=[],t.selectedCat={},t.orderedCatList=[],e.getList().then(function(e){t.listCategory=e,t.selectedCat=t.listCategory[0]||{}},function(t){toastr.error("การแสดงผลผิดพลาด")});var r=function(){e.getOrderedList().then(function(e){t.orderedCatList=e},function(t){toastr.error("การแสดงผลผิดพลาด")})};r(),t.addCategory=function(){void 0===_.find(t.orderedCatList,["id",t.selectedCat.id])?t.orderedCatList.push(t.selectedCat):toastr.warning("คุณได้เพิ่มหมวดหมู่นี้ไปแล้ว!!")},t.removeCategory=function(e){_.remove(t.orderedCatList,function(t){return t.id==e})},t.saveChange=function(){var o=_.map(t.orderedCatList,"id");o=o.join(","),e.setOrderedList(o).then(function(){toastr.success("บันทึกการเปลี่ยนแปลงเรียบร้อย"),r()},function(t){toastr.error("การบันทึกผิดพลาด"),r()})}}]).controller("comment",["$scope","commentService",function(t,e){t.status={wp:!1,fb:!1};var r=function(){e.getList().then(function(e){t.status={wp:1===parseInt(e[0]),fb:1===parseInt(e[1])}},function(t){toastr.error("การแสดงผลผิดพลาด")})};r(),t.changeStatus=function(e){t.status[e]=!t.status[e]},t.saveChange=function(){var o={wp:t.status.wp?1:0,fb:t.status.fb?1:0};strList=[o.wp,o.fb].join(","),e.setList(strList).then(function(){toastr.success("บันทึกการเปลี่ยนแปลงเรียบร้อย"),r()},function(t){toastr.error("การบันทึกผิดพลาด"),r()})}}]).controller("cover",["$scope","$rootScope","categoriesService","coverService",function(t,e,r,o){t.listCategory=[],t.currentCat={id:0,selected:"1",imgUrl:"",imgName:""},t.img={show:!1,url:""},r.getList().then(function(e){t.listCategory=e},function(t){toastr.error("การแสดงผลผิดพลาด")});var n=function(r,o){t.currentCat.id=r,t.currentCat.imgUrl="",t.currentCat.imgName="",-1===o.indexOf(e.config.theme_url+"/images/cover/")?(t.currentCat.selected="1",t.currentCat.imgUrl=o||"",t.showCoverImage(1)):(t.currentCat.selected="2",t.currentCat.imgName=o.split("/").pop()||"",t.showCoverImage(2))};t.openPopup=function(e){t.img={show:!1,url:""},$("#coverPopup").modal("show"),0===e?(t.currentCatName="หน้าแรก",o.getHomepageImageUrl().then(function(t){n(0,t)},function(t){toastr.error("ไม่สามารถดึงข้อมูลรูปภาพได้")})):(t.currentCatName=t.listCategory[_.findIndex(t.listCategory,["id",e])].name||"",o.getImageUrl(e).then(function(t){n(e,t)},function(t){toastr.error("ไม่สามารถดึงข้อมูลรูปภาพได้")}))},t.showCoverImage=function(r){1===r&&"1"===t.currentCat.selected?new RegExp("(^https?://.*.(?:png|jpg))").test(t.currentCat.imgUrl)?(t.img.show=!0,t.img.url=t.currentCat.imgUrl):(t.img.show=!1,t.img.url=""):2===r&&"2"===t.currentCat.selected&&new RegExp("^.*.(jpg|jpeg|gif|JPG|png|PNG)").test(t.currentCat.imgName)?(t.img.show=!0,t.img.url=e.config.theme_url+"/images/cover/"+t.currentCat.imgName):(t.img.show=!1,t.img.url="")},t.saveChange=function(){0===t.currentCat.id?o.setHomepageImageUrl(t.img.url).then(function(){$("#coverPopup").modal("hide"),toastr.success("บันทึกการเปลี่ยนแปลงเรียบร้อย")},function(t){$("#coverPopup").modal("hide"),toastr.error("การบันทึกผิดพลาด")}):o.setImageUrl(t.currentCat.id,t.img.url).then(function(){$("#coverPopup").modal("hide"),toastr.success("บันทึกการเปลี่ยนแปลงเรียบร้อย")},function(t){$("#coverPopup").modal("hide"),toastr.error("การบันทึกผิดพลาด")})}}]);
